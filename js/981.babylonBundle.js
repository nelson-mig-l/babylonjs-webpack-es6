"use strict";(self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[]).push([[981],{307:(i,s,t)=>{t.d(s,{$6:()=>_,DG:()=>g,Es:()=>c,Qq:()=>l,W:()=>b,kt:()=>p,vU:()=>f});var e=t(972),n=t(9859),o=t(3632),h=t(4517),r=t(6994),a=t(4651),u=t(78),d=t(7786),m=t(3027);function p(i){const s=[],t=[],n=[],o=[];let r,a;const u=i.width||1,d=i.height||1,p=i.subdivisionsX||i.subdivisions||1,c=i.subdivisionsY||i.subdivisions||1;for(r=0;r<=c;r++)for(a=0;a<=p;a++){const i=new e.P(a*u/p-u/2,0,(c-r)*d/c-d/2),s=new e.P(0,1,0);t.push(i.x,i.y,i.z),n.push(s.x,s.y,s.z),o.push(a/p,m.e.UseOpenGLOrientationForUV?r/c:1-r/c)}for(r=0;r<c;r++)for(a=0;a<p;a++)s.push(a+1+(r+1)*(p+1)),s.push(a+1+r*(p+1)),s.push(a+r*(p+1)),s.push(a+(r+1)*(p+1)),s.push(a+1+(r+1)*(p+1)),s.push(a+r*(p+1));const l=new h.x;return l.indices=s,l.positions=t,l.normals=n,l.uvs=o,l}function c(i){const s=void 0!==i.xmin&&null!==i.xmin?i.xmin:-1,t=void 0!==i.zmin&&null!==i.zmin?i.zmin:-1,n=void 0!==i.xmax&&null!==i.xmax?i.xmax:1,o=void 0!==i.zmax&&null!==i.zmax?i.zmax:1,r=i.subdivisions||{w:1,h:1},a=i.precision||{w:1,h:1},u=new Array,d=new Array,m=new Array,p=new Array;let c,l,_,g;r.h=r.h<1?1:r.h,r.w=r.w<1?1:r.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;const b=(n-s)/r.w,f=(o-t)/r.h;function x(i,s,t,n){const o=d.length/3,h=a.w+1;for(c=0;c<a.h;c++)for(l=0;l<a.w;l++){const i=[o+l+c*h,o+(l+1)+c*h,o+(l+1)+(c+1)*h,o+l+(c+1)*h];u.push(i[1]),u.push(i[2]),u.push(i[3]),u.push(i[0]),u.push(i[1]),u.push(i[3])}const r=e.P.Zero(),_=new e.P(0,1,0);for(c=0;c<=a.h;c++)for(r.z=c*(n-s)/a.h+s,l=0;l<=a.w;l++)r.x=l*(t-i)/a.w+i,r.y=0,d.push(r.x,r.y,r.z),m.push(_.x,_.y,_.z),p.push(l/a.w,c/a.h)}for(_=0;_<r.h;_++)for(g=0;g<r.w;g++)x(s+g*b,t+_*f,s+(g+1)*b,t+(_+1)*f);const v=new h.x;return v.indices=u,v.positions=d,v.normals=m,v.uvs=p,v}function l(i){const s=[],t=[],o=[],r=[];let a,u;const m=i.colorFilter||new n.Wo(.3,.59,.11),p=i.alphaFilter||0;let c=!1;if(i.minHeight>i.maxHeight){c=!0;const s=i.maxHeight;i.maxHeight=i.minHeight,i.minHeight=s}for(a=0;a<=i.subdivisions;a++)for(u=0;u<=i.subdivisions;u++){const s=new e.P(u*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-a)*i.height/i.subdivisions-i.height/2),n=4*(((s.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(s.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth);let h=i.buffer[n]/255,l=i.buffer[n+1]/255,_=i.buffer[n+2]/255;const g=i.buffer[n+3]/255;c&&(h=1-h,l=1-l,_=1-_);const b=h*m.r+l*m.g+_*m.b;s.y=g>=p?i.minHeight+(i.maxHeight-i.minHeight)*b:i.minHeight-d.kn,t.push(s.x,s.y,s.z),o.push(0,0,0),r.push(u/i.subdivisions,1-a/i.subdivisions)}for(a=0;a<i.subdivisions;a++)for(u=0;u<i.subdivisions;u++){const e=u+1+(a+1)*(i.subdivisions+1),n=u+1+a*(i.subdivisions+1),o=u+a*(i.subdivisions+1),h=u+(a+1)*(i.subdivisions+1),r=t[3*e+1]>=i.minHeight,d=t[3*n+1]>=i.minHeight,m=t[3*o+1]>=i.minHeight;r&&d&&m&&(s.push(e),s.push(n),s.push(o)),t[3*h+1]>=i.minHeight&&r&&m&&(s.push(h),s.push(e),s.push(o))}h.x.ComputeNormals(t,s,o);const l=new h.x;return l.indices=s,l.positions=t,l.normals=o,l.uvs=r,l}function _(i,s={},t){const e=new r.E(i,t);return e._setReady(!1),e._subdivisionsX=s.subdivisionsX||s.subdivisions||1,e._subdivisionsY=s.subdivisionsY||s.subdivisions||1,e._width=s.width||1,e._height=s.height||1,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ,p(s).applyToMesh(e,s.updatable),e._setReady(!0),e}function g(i,s,t=null){const e=new o.Kj(i,t);return c(s).applyToMesh(e,s.updatable),e}function b(i,s,t={},e=null){const o=t.width||10,h=t.height||10,d=t.subdivisions||1,m=t.minHeight||0,p=t.maxHeight||1,c=t.colorFilter||new n.Wo(.3,.59,.11),_=t.alphaFilter||0,g=t.updatable,b=t.onReady;e=e||u.l.LastCreatedScene;const f=new r.E(i,e);return f._subdivisionsX=d,f._subdivisionsY=d,f._width=o,f._height=h,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),a.w1.LoadImage(s,(i=>{const s=i.width,t=i.height;if(e.isDisposed)return;const n=null==e?void 0:e.getEngine().resizeImageBitmap(i,s,t);l({width:o,height:h,subdivisions:d,minHeight:m,maxHeight:p,colorFilter:c,buffer:n,bufferWidth:s,bufferHeight:t,alphaFilter:_}).applyToMesh(f,g),b&&b(f),f._setReady(!0)}),(()=>{}),e.offlineProvider),f}const f={CreateGround:_,CreateGroundFromHeightMap:b,CreateTiledGround:g};h.x.CreateGround=p,h.x.CreateTiledGround=c,h.x.CreateGroundFromHeightMap=l,o.Kj.CreateGround=(i,s,t,e,n,o)=>_(i,{width:s,height:t,subdivisions:e,updatable:o},n),o.Kj.CreateTiledGround=(i,s,t,e,n,o,h,r,a)=>g(i,{xmin:s,zmin:t,xmax:e,zmax:n,subdivisions:o,precision:h,updatable:a},r),o.Kj.CreateGroundFromHeightMap=(i,s,t,e,n,o,h,r,a,u,d)=>b(i,s,{width:t,height:e,subdivisions:n,minHeight:o,maxHeight:h,updatable:a,onReady:u,alphaFilter:d},r)},6765:(i,s,t)=>{t.d(s,{A1:()=>u,Qk:()=>a,jY:()=>r});var e=t(972),n=t(3632),o=t(4517),h=t(3027);function r(i){const s=i.segments||32,t=i.diameterX||i.diameter||1,n=i.diameterY||i.diameter||1,r=i.diameterZ||i.diameter||1,a=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,u=i.slice&&i.slice<=0?1:i.slice||1,d=0===i.sideOrientation?0:i.sideOrientation||o.x.DEFAULTSIDE,m=!!i.dedupTopBottomIndices,p=new e.P(t/2,n/2,r/2),c=2+s,l=2*c,_=[],g=[],b=[],f=[];for(let i=0;i<=c;i++){const s=i/c,t=s*Math.PI*u;for(let i=0;i<=l;i++){const n=i/l,o=n*Math.PI*2*a,r=e.y3.RotationZ(-t),u=e.y3.RotationY(o),d=e.P.TransformCoordinates(e.P.Up(),r),m=e.P.TransformCoordinates(d,u),c=m.multiply(p),_=m.divide(p).normalize();g.push(c.x,c.y,c.z),b.push(_.x,_.y,_.z),f.push(n,h.e.UseOpenGLOrientationForUV?1-s:s)}if(i>0){const s=g.length/3;for(let t=s-2*(l+1);t+l+2<s;t++)m?(i>1&&(_.push(t),_.push(t+1),_.push(t+l+1)),(i<c||u<1)&&(_.push(t+l+1),_.push(t+1),_.push(t+l+2))):(_.push(t),_.push(t+1),_.push(t+l+1),_.push(t+l+1),_.push(t+1),_.push(t+l+2))}}o.x._ComputeSides(d,g,_,b,f,i.frontUVs,i.backUVs);const x=new o.x;return x.indices=_,x.positions=g,x.normals=b,x.uvs=f,x}function a(i,s={},t=null){const e=new n.Kj(i,t);return s.sideOrientation=n.Kj._GetDefaultSideOrientation(s.sideOrientation),e._originalBuilderSideOrientation=s.sideOrientation,r(s).applyToMesh(e,s.updatable),e}const u={CreateSphere:a};o.x.CreateSphere=r,n.Kj.CreateSphere=(i,s,t,e,n,o)=>a(i,{segments:s,diameterX:t,diameterY:t,diameterZ:t,sideOrientation:o,updatable:n},e)},6994:(i,s,t)=>{t.d(s,{E:()=>h});var e=t(972),n=t(7959),o=t(3632);o.Kj._GroundMeshParser=(i,s)=>h.Parse(i,s);class h extends o.Kj{constructor(i,s){super(i,s),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(i,s=32){this._subdivisionsX=i,this._subdivisionsY=i,this.subdivide(i);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(s)}getHeightAtCoordinates(i,s){const t=this.getWorldMatrix(),n=e.jp.Matrix[5];t.invertToRef(n);const o=e.jp.Vector3[8];if(e.P.TransformCoordinatesFromFloatsToRef(i,0,s,n,o),i=o.x,s=o.z,i<this._minX||i>=this._maxX||s<=this._minZ||s>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(i,s),r=-(h.x*i+h.z*s+h.w)/h.y;return e.P.TransformCoordinatesFromFloatsToRef(0,r,0,t,o),o.y}getNormalAtCoordinates(i,s){const t=new e.P(0,1,0);return this.getNormalAtCoordinatesToRef(i,s,t),t}getNormalAtCoordinatesToRef(i,s,t){const n=this.getWorldMatrix(),o=e.jp.Matrix[5];n.invertToRef(o);const h=e.jp.Vector3[8];if(e.P.TransformCoordinatesFromFloatsToRef(i,0,s,o,h),i=h.x,s=h.z,i<this._minX||i>this._maxX||s<this._minZ||s>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(i,s);return e.P.TransformNormalFromFloatsToRef(r.x,r.y,r.z,n,t),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(i,s){const t=Math.floor((i+this._maxX)*this._subdivisionsX/this._width),e=Math.floor(-(s+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[e*this._subdivisionsX+t];let o;return o=s<n.slope.x*i+n.slope.y?n.facet1:n.facet2,o}_initHeightQuads(){const i=this._subdivisionsX,s=this._subdivisionsY;this._heightQuads=new Array;for(let t=0;t<s;t++)for(let s=0;s<i;s++){const n={slope:e.FM.Zero(),facet1:new e.Lt(0,0,0,0),facet2:new e.Lt(0,0,0,0)};this._heightQuads[t*i+s]=n}return this}_computeHeightQuads(){const i=this.getVerticesData(n.o.PositionKind);if(!i)return this;const s=e.jp.Vector3[3],t=e.jp.Vector3[2],o=e.jp.Vector3[1],h=e.jp.Vector3[0],r=e.jp.Vector3[4],a=e.jp.Vector3[5],u=e.jp.Vector3[6],d=e.jp.Vector3[7],m=e.jp.Vector3[8];let p=0,c=0,l=0,_=0,g=0,b=0,f=0;const x=this._subdivisionsX,v=this._subdivisionsY;for(let n=0;n<v;n++)for(let v=0;v<x;v++){p=3*v,c=n*(x+1)*3,l=(n+1)*(x+1)*3,s.x=i[c+p],s.y=i[c+p+1],s.z=i[c+p+2],t.x=i[c+p+3],t.y=i[c+p+4],t.z=i[c+p+5],o.x=i[l+p],o.y=i[l+p+1],o.z=i[l+p+2],h.x=i[l+p+3],h.y=i[l+p+4],h.z=i[l+p+5],_=(h.z-s.z)/(h.x-s.x),g=s.z-_*s.x,t.subtractToRef(s,r),o.subtractToRef(s,a),h.subtractToRef(s,u),e.P.CrossToRef(u,a,d),e.P.CrossToRef(r,u,m),d.normalize(),m.normalize(),b=-(d.x*s.x+d.y*s.y+d.z*s.z),f=-(m.x*t.x+m.y*t.y+m.z*t.z);const w=this._heightQuads[n*x+v];w.slope.copyFromFloats(_,g),w.facet1.copyFromFloats(d.x,d.y,d.z,b),w.facet2.copyFromFloats(m.x,m.y,m.z,f)}return this}serialize(i){super.serialize(i),i.subdivisionsX=this._subdivisionsX,i.subdivisionsY=this._subdivisionsY,i.minX=this._minX,i.maxX=this._maxX,i.minZ=this._minZ,i.maxZ=this._maxZ,i.width=this._width,i.height=this._height}static Parse(i,s){const t=new h(i.name,s);return t._subdivisionsX=i.subdivisionsX||1,t._subdivisionsY=i.subdivisionsY||1,t._minX=i.minX,t._maxX=i.maxX,t._minZ=i.minZ,t._maxZ=i.maxZ,t._width=i.width,t._height=i.height,t}}}}]);
//# sourceMappingURL=981.babylonBundle.js.map